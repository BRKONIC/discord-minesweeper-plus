<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Discord用マインスイーパー生成機プラス</title>
  <meta property="og:title" content="Discord用マインスイーパー生成機プラス" />
  <meta property="og:description" content="マインスイーパーをMarkdown形式で生成します。" />
  <meta property="og:image" content="https://brkonic.github.io/discord-minesweeper-plus//images/discord-minesweeper-plus-image.png" />
  <meta property="og:url" content="https://brkonic.github.io/discord-minesweeper-plus/" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Discord用マインスイーパー生成機プラス" />
  <meta name="twitter:description" content="マインスイーパーをMarkdown形式で生成します。" />
  <meta name="twitter:image" content="https://brkonic.github.io/discord-minesweeper-plus//images/discord-minesweeper-plus-image.png" /> 
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      background-color: #212121;
      color: #f1f1f1;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1, h2 {
      text-align: center;
      margin-bottom: 10px;
    }

    .mt-2 { margin-top: 20px; }
    .mb-1 { margin-bottom: 10px; }
    .mb-2 { margin-bottom: 20px; }
    
    .w-auto { width: auto !important; }

    .controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      width: 100%;
      max-width: 680px;
    }

    .controls label {
      display: flex;
      flex-direction: column;
      color: #ccc;
      width: 150px;
    }

    .checkbox-inline {
      display: flex;
      align-items: center;
      gap: 5px;
      color: #ccc;
    }

    input[type="text"], input[type="number"] {
      padding: 8px;
      margin-top: 5px;
      border: none;
      border-radius: 5px;
      background-color: #333;
      color: #f1f1f1;
    }

    button {
      padding: 10px 20px;
      margin: 5px;
      background-color: #333;
      color: #f1f1f1;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    button:hover {
      background-color: #555;
    }

    .radio-controls {
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .radio-controls input[type="radio"] {
      display: none;
    }

    .radio-controls label {
      padding: 10px 20px;
      background-color: #333;
      color: #f1f1f1;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .radio-controls label:hover {
      background-color: #555;
    }

    .radio-controls input[type="radio"]:checked + label {
      background-color: #f1f1f1;
      color: #0f0f0f;
    }

    textarea {
      width: 100%;
      max-width: 680px;
      padding: 10px 16px;
      background-color: #333;
      color: #f1f1f1;
      border: none;
      border-radius: 5px;
      resize: none;
      margin-bottom: 20px;
    }

    .sub-text { color: #aaa; }
    .danger-text { color: #FF0033; }
    .notes-text { color: #fbc02d; }

    table {
      border-collapse: collapse;
      cursor: pointer;
      user-select: none;
      margin-top: 10px;
    }

    td {
      width: 30px;
      height: 30px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      text-align: center;
    }

    .spoiler {
      color: transparent;
    }
    
    .isReveal {
      color: #79dfc1 !important;
    }

    tr:not(.highlight-row) .spoiler:not(.highlight-col) {
      background-color: #444;
    }

    td.spoiler:hover {
      background-color: #616161;
    }

    .highlight-row, .highlight-col {
      background-color: #757575;
    }

    td:not(.spoiler) {
      background-color: #212121;
      cursor: auto;
    }

    td:not(.spoiler):hover {
      background-color: #212121;
    }

    @media (max-width: 600px) {
      body {
        padding: 10px;
      }

      .controls {
        flex-direction: column;
        align-items: stretch;
      }

      .controls label {
        width: 100%;
        align-items: flex-start;
      }

      input[type="text"], input[type="number"] {
        width: 100%;
        font-size: 16px;
      }

      button {
        width: 100%;
        font-size: 16px;
      }

      .radio-controls {
        flex-direction: column;
        gap: 5px;
      }

      .radio-controls label {
        width: 100%;
        text-align: center;
      }

      textarea {
        font-size: 14px;
      }

      td {
        width: 24px;
        height: 24px;
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <h1>Discord用マインスイーパー生成機プラス</h1>
  <p class="sub-text mb-2">マインスイーパーをMarkdown形式で生成します。</p>

  <div class="controls mb-1">
    <label>幅<input id="width" type="number" value="9" min="1" max="100" placeholder="ボードの幅"></label>
    <label>高さ<input id="height" type="number" value="9" min="1" max="100" placeholder="ボードの高さ"></label>
    <label>地雷数<input id="count" type="number" value="10" min="1" max="10000" placeholder="ボードの地雷数"></label>
    <label>地雷用絵文字<input id="emoji" type="text" value=":bomb:" placeholder="地雷用絵文字の名前"></label>
  </div>
  
  <div class="controls mb-1">
    <div class="checkbox-inline">
      <input id="reveal-safe" type="checkbox" checked />
      <label for="reveal-safe" class="checkbox-inline w-auto">
        安全そうなマスを1つ公開する
      </label>
    </div>
  </div>
  
  <div class="controls mb-1">
    <button onclick="generate()">生成</button>
    <button onclick="copy()">コピー</button>
    <button onclick="inputClear()">クリア</button>
  </div>

  <textarea id="output" rows="10" placeholder="生成結果" readonly></textarea>
  <p>生成文字数: <span id="character-count">0</span>文字</p>
  <p class="notes-text mb-2">※Discordは2000文字まで</p>

  <h2>お試し</h2>
  <div class="radio-controls mb-1">
    <input type="radio" id="spoiler" name="spoiler" onclick="spoilerAll()" checked>
    <label for="spoiler">すべてスポイラー</label>
    <input type="radio" id="reveal" name="spoiler" onclick="revealAll()">
    <label for="reveal">スポイラー解除</label>
  </div>

  <table id="try-board"></table>

  <script>
    function getRandomInt(max) {
      return Math.floor(Math.random() * max);
    }

    function generate() {
      const output = document.getElementById("output");
      const countDisplay = document.getElementById("character-count");
      const tryBoard = document.getElementById("try-board");
      const width = parseInt(document.getElementById("width").value);
      const height = parseInt(document.getElementById("height").value);
      let count = parseInt(document.getElementById("count").value);
      const emoji = document.getElementById("emoji").value;
      const spoiler = document.getElementById("spoiler").checked;
      const revealOne = document.getElementById("reveal-safe").checked;

      if (count > (width - 1) * (height - 1)) {
        count = (width - 1) * (height - 1);
      }

      const board = Array.from({ length: height }, () => Array(width).fill(0));
      while (tryBoard.rows.length) tryBoard.deleteRow(0);

      let placed = 0;
      while (placed < count) {
        const r = getRandomInt(height);
        const c = getRandomInt(width);
        if (board[r][c] < 0) continue;
        board[r][c] = -10000;
        for (let dr = -1; dr <= 1; dr++) {
          for (let dc = -1; dc <= 1; dc++) {
            const nr = r + dr, nc = c + dc;
            if (nr >= 0 && nr < height && nc >= 0 && nc < width && board[nr][nc] >= 0) {
              board[nr][nc]++;
            }
          }
        }
        placed++;
      }

      const safeCells = [];
      for (let r = 0; r < height; r++) {
        for (let c = 0; c < width; c++) {
          if (board[r][c] === 0) safeCells.push({ r, c });
        }
      }
      const revealCell = revealOne && safeCells.length > 0 ? safeCells[getRandomInt(safeCells.length)] : null;

      let text = "";
      const emojiMap = [":zero:", ":one:", ":two:", ":three:", ":four:", ":five:", ":six:", ":seven:", ":eight:"];
      for (let r = 0; r < height; r++) {
        const tr = tryBoard.insertRow();
        for (let c = 0; c < width; c++) {
          const td = tr.insertCell();
          const isReveal = revealCell && revealCell.r === r && revealCell.c === c;

          if (spoiler && !isReveal) td.classList.add("spoiler");
          if (isReveal) td.classList.add("isReveal");

          if (board[r][c] < 0) {
            td.textContent = "x";
            td.classList.add("danger-text");
            text += !isReveal ? `||${emoji}||` : emoji;
          } else {
            td.textContent = isReveal? "●" : board[r][c] || "";
            const mark = emojiMap[board[r][c]] || ":zero:";
            text += !isReveal ? `||${mark}||` : mark;
          }
        }
        text += "\n";
      }

      output.value = text;
      countDisplay.textContent = text.length;
      countDisplay.classList.toggle("danger-text", text.length > 2000);
    }

    function copy() {
      const output = document.getElementById("output");
      output.select();
      document.execCommand("copy");
    }

    function inputClear() {
      document.getElementById("width").value = 9;
      document.getElementById("height").value = 9;
      document.getElementById("count").value = 10;
      document.getElementById("emoji").value = ":bomb:";
      document.getElementById("output").value = "";
      document.getElementById("reveal-safe").checked = false;
    }

    function revealAll() {
      document.querySelectorAll("#try-board td").forEach(td => td.classList.remove("spoiler"));
    }

    function spoilerAll() {
      document.querySelectorAll("#try-board td").forEach(td => {
        if (!td.classList.contains("isReveal")) {
          td.classList.add("spoiler");
        }
      });
    }

    document.getElementById("try-board").addEventListener("click", (e) => {
      if (e.target.tagName === "TD") {
        e.target.classList.remove("spoiler");
      }
    });

    document.getElementById("try-board").addEventListener("mouseover", (e) => {
      if (e.target.tagName === "TD") {
        const row = e.target.parentElement;
        row.classList.add("highlight-row");

        const index = [...e.target.parentElement.children].indexOf(e.target);
        document.querySelectorAll("#try-board tr").forEach(tr => {
          if (tr.children[index]) {
            tr.children[index].classList.add("highlight-col");
          }
        });
      }
    });

    document.getElementById("try-board").addEventListener("mouseout", (e) => {
      if (e.target.tagName === "TD") {
        const row = e.target.parentElement;
        row.classList.remove("highlight-row");

        const index = [...e.target.parentElement.children].indexOf(e.target);
        document.querySelectorAll("#try-board tr").forEach(tr => {
          if (tr.children[index]) {
            tr.children[index].classList.remove("highlight-col");
          }
        });
      }
    });

    generate();
  </script>
</body>
</html>
